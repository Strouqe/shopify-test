{%- liquid
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
  assign neck_image = section.settings.neck_image
  assign back_image = section.settings.back_image
  assign chest_image = section.settings.chest_image
  assign legs_image = section.settings.legs_image
-%}

<dialog id="size-chart-dialog" class="size-chart-dialog">
  <div class="popup-content">
    <button
      type="button"
      id="close-popup"
      class="popup-close"
      aria-label="Close">&times;</button>
    <div class="popup-body">
      {%- if heading != blank -%}
        <h2>{{ heading }}</h2>
      {%- endif -%}
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'size-chart-table' -%}
            {%- comment -%} Desktop table {%- endcomment -%}
            <div class="size-chart-table size-chart-table--desktop">
              <table>
                <thead>
                  <tr>
                    <th style="background-color: black;">SIZE</th>
                    <th style="background-color: black;">BACK LENGTH (CM)</th>
                    <th style="background-color: black;">CHEST LENGTH (CM)</th>
                    <th style="background-color: black;">NECK LENGTH (CM)</th>
                    <th style="background-color: black;">BREED</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>S</td>
                    <td>29-33</td>
                    <td>43-48</td>
                    <td>28-31</td>
                    <td>Boston Terrier, Shih Tzu, Pug, Poodle, Chinese Crested, Yorkie, Pekingese Spitz, Maltese, Miniature Pinscher</td>
                  </tr>
                  <tr>
                    <td>M</td>
                    <td>34-36</td>
                    <td>49-54</td>
                    <td>32-34</td>
                    <td>Boston Terrier, Shih Tzu, Pug, Cocker Spaniel, Miniature Schnauzer, Dachshund</td>
                  </tr>
                  <tr>
                    <td>L</td>
                    <td>37-41</td>
                    <td>55-60</td>
                    <td>35-40</td>
                    <td>Cocker Spaniel, Bull Terrier, Fox Terrier, French Bulldog, Beagle, Biewer-Yorkie, Poodle.</td>
                  </tr>
                  <tr>
                    <td>XL</td>
                    <td>42-50</td>
                    <td>61-70</td>
                    <td>46-50</td>
                    <td>Welsh Corgi, French Bulldog, Cocker Spaniel, Bull Terrier, Beagle</td>
                  </tr>
                  <tr>
                    <td>2XL</td>
                    <td>51-55</td>
                    <td>71-80</td>
                    <td>46-50</td>
                    <td>Labrador, Golden Retriever, German Shepherd, Husky.</td>
                  </tr>
                </tbody>
              </table>
            </div>

            {%- comment -%} Mobile div-based layout (looks like table) {%- endcomment -%}
            <div class="size-chart-mobile">
              <div class="size-chart-mobile__header">
                <div class="size-chart-mobile__header-cell">SIZE</div>
                <div class="size-chart-mobile__header-cell">BACK LENGTH (CM)</div>
                <div class="size-chart-mobile__header-cell">CHEST LENGTH (CM)</div>
                <div class="size-chart-mobile__header-cell">NECK LENGTH (CM)</div>
              </div>

              <div class="size-chart-mobile__row-wrapper">
                <div class="size-chart-mobile__breed">Boston Terrier, Shih Tzu, Pug, Poodle, Chinese Crested, Yorkie, Pekingese Spitz, Maltese, Miniature Pinscher</div>
                <div class="size-chart-mobile__row">
                  <div class="size-chart-mobile__cell">S</div>
                  <div class="size-chart-mobile__cell">29-33</div>
                  <div class="size-chart-mobile__cell">43-48</div>
                  <div class="size-chart-mobile__cell">28-31</div>
                </div>
              </div>

              <div class="size-chart-mobile__row-wrapper size-chart-mobile__row-wrapper--even">
                <div class="size-chart-mobile__breed">Boston Terrier, Shih Tzu, Pug, Cocker Spaniel, Miniature Schnauzer, Dachshund</div>
                <div class="size-chart-mobile__row">
                  <div class="size-chart-mobile__cell">M</div>
                  <div class="size-chart-mobile__cell">34-36</div>
                  <div class="size-chart-mobile__cell">49-54</div>
                  <div class="size-chart-mobile__cell">32-34</div>
                </div>
              </div>

              <div class="size-chart-mobile__row-wrapper">
                <div class="size-chart-mobile__breed">Cocker Spaniel, Bull Terrier, Fox Terrier, French Bulldog, Beagle, Biewer-Yorkie, Poodle.</div>
                <div class="size-chart-mobile__row">
                  <div class="size-chart-mobile__cell">L</div>
                  <div class="size-chart-mobile__cell">37-41</div>
                  <div class="size-chart-mobile__cell">55-60</div>
                  <div class="size-chart-mobile__cell">35-40</div>
                </div>
              </div>

              <div class="size-chart-mobile__row-wrapper size-chart-mobile__row-wrapper--even">
                <div class="size-chart-mobile__breed">Welsh Corgi, French Bulldog, Cocker Spaniel, Bull Terrier, Beagle</div>
                <div class="size-chart-mobile__row">
                  <div class="size-chart-mobile__cell">XL</div>
                  <div class="size-chart-mobile__cell">42-50</div>
                  <div class="size-chart-mobile__cell">61-70</div>
                  <div class="size-chart-mobile__cell">46-50</div>
                </div>
              </div>

              <div class="size-chart-mobile__row-wrapper">
                <div class="size-chart-mobile__breed">Labrador, Golden Retriever, German Shepherd, Husky.</div>
                <div class="size-chart-mobile__row">
                  <div class="size-chart-mobile__cell">2XL</div>
                  <div class="size-chart-mobile__cell">51-55</div>
                  <div class="size-chart-mobile__cell">71-80</div>
                  <div class="size-chart-mobile__cell">46-50</div>
                </div>
              </div>
            </div>
        {%- endcase -%}
      {%- endfor -%}
      {%- if subheading != blank -%}
        <div class="size-chart-subheading">{{ subheading }}</div>
      {%- endif -%}
      <div class="measurement-images">
        <div class="measurement-item">
          {% if neck_image %}
            {{ neck_image | image_url: width: 200 | image_tag: alt: 'Around the Neck' }}
          {% else %}
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMDAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zNWVtIiBmaWxsPSIjOUI5QkE0IiBmb250LXNpemU9IjE0Ij5ObyBJbWFnZTwvdGV4dD4KPHN2Zz4=" alt="No image selected">
          {% endif %}
          <p>AROUND THE NECK</p>
        </div>
        <div class="measurement-item">
          {% if back_image %}
            {{ back_image | image_url: width: 200 | image_tag: alt: 'The Back' }}
          {% else %}
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMDAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zNWVtIiBmaWxsPSIjOUI5QkE0IiBmb250LXNpemU9IjE0Ij5ObyBJbWFnZTwvdGV4dD4KPHN2Zz4=" alt="No image selected">
          {% endif %}
          <p>THE BACK</p>
        </div>
        <div class="measurement-item">
          {% if chest_image %}
            {{ chest_image | image_url: width: 200 | image_tag: alt: 'The Chest' }}
          {% else %}
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMDAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zNWVtIiBmaWxsPSIjOUI5QkE0IiBmb250LXNpemU9IjE0Ij5ObyBJbWFnZTwvdGV4dD4KPHN2Zz4=" alt="No image selected">
          {% endif %}
          <p>THE CHEST</p>
        </div>
        <div class="measurement-item">
          {% if legs_image %}
            {{ legs_image | image_url: width: 200 | image_tag: alt: 'The Legs' }}
          {% else %}
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMDAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zNWVtIiBmaWxsPSIjOUI5QkE0IiBmb250LXNpemU9IjE0Ij5ObyBJbWFnZTwvdGV4dD4KPHN2Zz4=" alt="No image selected">
          {% endif %}
          <p>THE LEGS</p>
        </div>
      </div>
    </div>
  </div>
</dialog>

{% stylesheet %}
  .size-chart-dialog {
    border: none;
    background: transparent;
    padding: 0;
    max-width: 1130px;
    width: 100%;
    margin: auto;
  }

  .size-chart-dialog::backdrop {
    background-color: rgba(0, 0, 0, 0.5);
  }

  .popup-content {
    background-color: var(--color-background);
    padding: 20px 70px;
    position: relative;
    display: flex;
    width: 100%;
  }

  .popup-close {
    position: absolute;
    right: 1rem;
    top: 1rem;
    font-size: 1.5rem;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
    color: var(--color-foreground);
    z-index: 2;
  }

  .popup-close:hover {
    opacity: 0.7;
  }

  .popup-body {
    color: var(--color-foreground);
    width: 100%;
  }

  .popup-body h2 {
    text-align: center;
    margin-bottom: 1rem;
  }

  .size-chart-table {
    width: 100%;
    margin: 1rem 0;
  }

  .size-chart-table table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
    table-layout: fixed;
  }

  .size-chart-table thead {
    background-color: black;
  }

  .size-chart-table th,
  .size-chart-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
    white-space: normal;
  }

  .size-chart-table th:not(:last-child),
  .size-chart-table td:not(:last-child) {
    text-align: center;
  }

  .size-chart-table th {
    color: white;
    font-weight: 600;
  }

  .size-chart-table th:nth-child(1),
  .size-chart-table th:nth-child(2),
  .size-chart-table th:nth-child(3),
  .size-chart-table th:nth-child(4),
  .size-chart-table td:nth-child(1),
  .size-chart-table td:nth-child(2),
  .size-chart-table td:nth-child(3),
  .size-chart-table td:nth-child(4) {
    width: 140px;
  }



  .size-chart-table td:first-child {
    font-weight: bold;
  }




  .size-chart-subheading {
    font-family: 'Open Sans'
    , sans-serif;
    font-weight: 600;
    font-size: 14px;
    line-height: 20px;
    letter-spacing: 0;
    text-align: center;
    text-transform: uppercase;
    margin: 32px auto;
    max-width: 400px;
    height: 40px;
  }

  .measurement-images {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 1.2rem auto;
    flex-wrap: nowrap;
    gap: 20px;
    max-width: 400px;
  }
  .measurement-images {
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    grid-template-rows: repeat(1, auto) !important;
    gap: 10px !important;
    place-items: center !important;
  }


  .measurement-item p {
    margin-top: 5px;
    font-family: 'Open Sans'
    , sans-serif;
    font-weight: 400;
    font-size: 14px;
    line-height: 20px;
    letter-spacing: 0;
    text-align: center;

    color: var(--color-foreground);
  }
  .measurement-item {
    width: 165px !important;
    display: flex;
    flex-flow: column nowrap;
  }

  .measurement-item img {
    width: 100% !important;
    height: auto !important;
  }

  .measurement-item p {
    font-size: 12px !important;
    line-height: 16px !important;
    margin-top: 0.5rem !important;
  }

  /* Mobile Styles */
@media screen and (max-width: 849px) {
  .size-chart-dialog {
    width: 100vw;
    height: 100vh;
    max-width: 100vw;
    max-height: 100vh;
    margin: 0;
  }
  .size-chart-table tbody tr:nth-child(even) {
    background-color: #f0f0f0;
  }
  .popup-content {
    padding: 1rem !important;
    flex-direction: column !important;
  }

  .popup-close {
    right: 0.5rem !important;
    top: 0.5rem !important;
    font-size: 1.25rem !important;
    padding: 0.75rem !important;
  }

  .popup-body {
    flex: 1 !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }

  /* Hide desktop table on mobile */
  .size-chart-table--desktop {
    display: none !important;
  }

  /* Mobile div-based table */
  .size-chart-mobile {
    display: block;
    margin: 0.5rem 0;
    width: 100%;
    font-size: 0.75rem;
  }

  .size-chart-mobile__header {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    background-color: black;
    height: 94px;
  }

  .size-chart-mobile__header-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: white;
    font-weight: 600;
    padding: 8px 4px;
    border-bottom: 1px solid var(--color-border);
  }

  .size-chart-mobile__row-wrapper {
    margin-bottom: 0;
  }
  .size-chart-mobile__breed {
    background-color: rgba(0, 0, 0, 0.05);
    padding: 8px;
    font-family: 'Open Sans', sans-serif;
    font-weight: 500;
    font-size: 14px;
    line-height: 20px;
    text-align: left;
    min-height: 94px;
    display: flex;
    align-items: center;
    overflow-wrap: break-word;
    word-wrap: break-word;
  }

  .size-chart-mobile__row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
  }

  .size-chart-mobile__cell {
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    height: 94px;
    background-color: white;
    border-bottom: 1px solid var(--color-border);
  }

  .size-chart-mobile__cell:first-child {
    font-weight: bold;
  }


  .size-chart-mobile__row {
    background-color: #f0f0f0;
  }

  .size-chart-subheading {
    font-size: 12px !important;
    line-height: 16px !important;
    margin: 1rem auto !important;
    max-width: 300px !important;
    height: auto !important;
  }

  .measurement-images {
    display: grid !important;
    grid-template-columns: repeat(2, 1fr) !important;
    grid-template-rows: repeat(2, auto) !important;
    gap: 10px !important;
    margin: 1rem auto !important;
    place-items: center !important;
  }
}


/* Hide mobile layout on desktop */
@media screen and (min-width: 850px) {
  .size-chart-mobile {
    display: none;
  }
}
{% endstylesheet %}

{% javascript %}
  class SizeChartPopup {
    constructor() {
      this.dialog = document.getElementById('size-chart-dialog');
      if (!this.dialog) return;
      

      this.init();
    }

    init() {
      document.addEventListener('click', (e) => {
        const trigger = e.target.closest('[data-action="open-size-chart"]');
        if (trigger) {
          e.preventDefault();
          this.openPopup();
        }
      });

      const closeBtn = this.dialog.querySelector('#close-popup');
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          this.closePopup();
        });
      }

      this.dialog.addEventListener('click', (e) => {
        if (e.target.id === 'size-chart-dialog') {
          this.closePopup();
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.dialog.hasAttribute('open')) {
          this.closePopup();
        }
      });
    }

    openPopup() {
      if (this.dialog && typeof this.dialog.showModal === 'function') {
        this.dialog.showModal();
        document.body.style.overflow = 'hidden';
      }
    }

    closePopup() {
      if (this.dialog && typeof this.dialog.close === 'function') {
        this.dialog.close();
        document.body.style.overflow = '';
      }
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    new SizeChartPopup();
  });
{% endjavascript %}

{% schema %}
  {
    "name": "Size Chart",
    "tag": "section",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Size Chart"
      },
      {
        "type": "text",
        "id": "subheading",
        "label": "Subheading",
        "default": "To get the right size for your dog you need to have a tape and measure across following parts:"
      },
      {
        "type": "image_picker",
        "id": "neck_image",
        "label": "Neck Measurement Image"
      },
      {
        "type": "image_picker",
        "id": "back_image",
        "label": "Back Measurement Image"
      }, {
        "type": "image_picker",
        "id": "chest_image",
        "label": "Chest Measurement Image"
      }, {
        "type": "image_picker",
        "id": "legs_image",
        "label": "Legs Measurement Image"
      }
    ],
    "blocks": [
      {
        "type": "size-chart-table",
        "name": "Size Chart Table",
        "limit": 1
      }
    ],
    "presets": [
      {
        "name": "Size Chart"
      }
    ]
  }
{% endschema %}